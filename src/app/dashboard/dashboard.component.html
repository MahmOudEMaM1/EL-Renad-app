<!-- dashboard/dashboard.component.html -->

<body>
    <mat-toolbar color="primary">
        <div class="logo-title-container">
            <img src="../assets/image2.png" alt="El-Renad Logo" class="navbar-logo">
            <span>El-Renad Travel Portal</span>
        </div>
        <span class="spacer"></span>
        <span *ngIf="currentUser">Welcome, {{ currentUser.name }}</span>
        <button mat-button (click)="logout()">Logout</button>
    </mat-toolbar>

    <div class="container">
        <h2>Registration List</h2>
        <div *ngIf="loading" class="loading">
            <mat-spinner diameter="40"></mat-spinner>
            <span>Loading registrations...</span>
        </div>
        <div *ngIf="error" class="error">
            {{ error }}
        </div>
        <table mat-table [dataSource]="registrations" *ngIf="!loading && !error">
            <ng-container matColumnDef="username">
                <th mat-header-cell *matHeaderCellDef> Username </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.username }} </td>
            </ng-container>
            <ng-container matColumnDef="tripTypeId">
                <th mat-header-cell *matHeaderCellDef> Trip Type </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.tripType?.type }} </td>
            </ng-container>
            <ng-container matColumnDef="tripPlaceId">
                <th mat-header-cell *matHeaderCellDef> Trip Place </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.tripPlace?.name }} </td>
            </ng-container>
            <ng-container matColumnDef="outboundTripTimeId">
                <th mat-header-cell *matHeaderCellDef> Outbound Time </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.outboundTripTime?.timeRange }} </td>
            </ng-container>
            <ng-container matColumnDef="returnTripTimeId">
                <th mat-header-cell *matHeaderCellDef> Return Time </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.returnTripTime?.timeRange }} </td>
            </ng-container>
            <ng-container matColumnDef="phoneNumber1">
                <th mat-header-cell *matHeaderCellDef> Phone 1 </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.phoneNumber1 }} </td>
            </ng-container>
            <ng-container matColumnDef="phoneNumber2">
                <th mat-header-cell *matHeaderCellDef> Phone 2 </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.phoneNumber2 }} </td>
            </ng-container>
            <ng-container matColumnDef="pay">
                <th mat-header-cell *matHeaderCellDef> Payment Status </th>
                <td mat-cell *matCellDef="let reg">
                    <span [ngClass]="{'paid': reg.pay, 'unpaid': !reg.pay}">
                        {{ reg.pay ? 'Paid' : 'Unpaid' }}
                    </span>
                </td>
            </ng-container>
            <ng-container matColumnDef="tiketPriceId">
                <th mat-header-cell *matHeaderCellDef> Ticket Price </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.tiketPrice?.price }} </td>
            </ng-container>
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let reg">
                    <button mat-button color="primary" *ngIf="!reg.pay" (click)="updatePaymentStatus(reg.id, true)">Mark as Paid</button>
                    <button mat-button color="warn" *ngIf="reg.pay" (click)="updatePaymentStatus(reg.id, false)">Mark as Unpaid</button>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>
</body>