<body>
    <mat-toolbar color="primary">
        <div class="logo-title-container">
            <img src="../assets/image2.png" alt="El-Renad Logo" class="navbar-logo">
            <span>{{ 'toolbar.title' | translate }}</span>
        </div>
        <span class="spacer"></span>
        <span *ngIf="currentUser">{{ 'toolbar.welcome' | translate: {name: currentUser.name} }}</span>
        <app-language-toggle></app-language-toggle>
        <button mat-button (click)="logout()">{{ 'toolbar.logout' | translate }}</button>
    </mat-toolbar>

    <div class="container">
        <h2>{{ 'dashboard.title' | translate }}</h2>
        <div *ngIf="loading" class="loading">
            <mat-spinner diameter="40"></mat-spinner>
            <span>{{ 'dashboard.loading' | translate }}</span>
        </div>
        <div *ngIf="error" class="error">
            {{ error | translate }}
        </div>
        <table mat-table [dataSource]="registrations" *ngIf="!loading && !error">
            <ng-container matColumnDef="username">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.username' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.username }} </td>
            </ng-container>
            <ng-container matColumnDef="tripTypeId">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.trip_type' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.tripType?.type }} </td>
            </ng-container>
            <ng-container matColumnDef="tripPlaceId">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.trip_place' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.tripPlace?.name }} </td>
            </ng-container>
            <ng-container matColumnDef="outboundTripTimeId">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.outbound_time' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.outboundTripTime?.timeRange }} </td>
            </ng-container>
            <ng-container matColumnDef="returnTripTimeId">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.return_time' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.returnTripTime?.timeRange }} </td>
            </ng-container>
            <ng-container matColumnDef="phoneNumber1">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.phone1' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.phoneNumber1 }} </td>
            </ng-container>
            <ng-container matColumnDef="phoneNumber2">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.phone2' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.phoneNumber2 }} </td>
            </ng-container>
            <ng-container matColumnDef="pay">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.payment_status' | translate }} </th>
                <td mat-cell *matCellDef="let reg">
                    <span [ngClass]="{'paid': reg.pay, 'unpaid': !reg.pay}">
                        {{ reg.pay ? ('dashboard.paid' | translate) : ('dashboard.unpaid' | translate) }}
                    </span>
                </td>
            </ng-container>
            <ng-container matColumnDef="tiketPriceId">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.ticket_price' | translate }} </th>
                <td mat-cell *matCellDef="let reg"> {{ reg.tiketPrice?.price }} </td>
            </ng-container>
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> {{ 'dashboard.actions' | translate }} </th>
                <td mat-cell *matCellDef="let reg">
                    <button mat-button color="primary" *ngIf="!reg.pay" (click)="updatePaymentStatus(reg.id, true)">
                        {{ 'dashboard.mark_paid' | translate }}
                    </button>
                    <button mat-button color="warn" *ngIf="reg.pay" (click)="updatePaymentStatus(reg.id, false)">
                        {{ 'dashboard.mark_unpaid' | translate }}
                    </button>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>
</body>